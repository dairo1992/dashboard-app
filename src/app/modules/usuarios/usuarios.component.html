<alert />
@if(usuariosQuery.isSuccess()){
<div class="flex gap-2 items-center h-20 p-3">
  <select class="select w-30 text-secondary" #txtLimitPages
    (change)="paginacionService.limitePorPagina.set(+txtLimitPages.value)">
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="20">20</option>
    <option value="50">50</option>
    <option value="100">100</option>
  </select>
  <label for="txtLimitPages" class="label text-base-100">Registros por pagina</label>
  <div class="flex flex-1"></div>
  <button class="btn btn-outline btn-neutral" (click)="modalUsuario()">NUEVO USUARIO</button>
</div>
<div class="flex overflow-x-auto">
  <!-- <div class="h-[65vh] w-full overflow-auto"> -->
  <table class="table table-xs w-full text-accent justify-end table-fixed">
    <thead class="text-primary bg-base-100 ">
      <tr>
        <th class="w-1/12"></th>
        <th class="w-3/12">Nombre</th>
        <th class="w-3/12">Rol</th>
        <th class="w-3/12">Correo</th>
        <th class="w-3/12">Fecha Creacion</th>
        <th class="w-2/12 text-center">Accion</th>
      </tr>
    </thead>
    <tbody>
      @for (usuario of usuariosQuery.data().data.usuarios; track usuario.id; let i = $index) {
      <tr class="border-b border-base-100">
        <th>{{i+1}}</th>
        <td>{{usuario.name }}</td>
        <td>{{usuario.role}}</td>
        <td>{{usuario.email}}</td>
        <td>{{usuario.created_at | date:'dd-MM-yyyy'}}</td>
        <td class="text-center">
          <button class="btn btn-square btn-sm" (click)="modalUsuario(usuario)">
            <span class="icon-[flowbite--edit-solid] text-xl text-primary"></span>
          </button>
        </td>
      </tr>
      }
      @empty {
      <tr class="border-b border-base-100">
        <td colspan="5" class="text-center py-4">
          NO DATA FOUND
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>
<!-- </div> -->
<div class="grid grid-cols-1 sm:grid-cols-1 mt-4">
  <app-paginacion [paginas]="usuariosQuery.data().data.pagination.last_page"
    [paginaActual]="usuariosQuery.data().data.pagination.current_page"></app-paginacion>

</div>
}
<dialog id="nuevo_usuario" #nuevo_usuario class="modal">
  <div class="modal-box w-11/12 max-w-5xl">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
    </form>
    <h3 class="text-lg font-bold flex justify-center">{{(usuarioForm.controls['id'].value != 0 &&
      usuarioForm.controls['id'].value != null) ? 'Editar Usuario: ' +
      usuarioForm.controls['name'].value : 'Nuevo Usuario'}}{{usuarioForm.controls['id'].value}}</h3>
    <div class="modal-body">
      <form [formGroup]="usuarioForm" (ngSubmit)="registrarUsuario()">
        <div class="form-control w-full mb-4">
          <label class="label" for="name">
            <span class="label-text">Nombre Completo</span>
          </label>
          <input type="text" formControlName="name" name="name" class="input input-bordered w-full" required />
          @if(formUtils.isValidField(usuarioForm, 'name')){
          <span class="text-red-500 text-sm mt-0">
            {{formUtils.getFieldError(usuarioForm, 'name')}}
          </span>
          }
        </div>

        <div class="form-control w-full mb-4">
          <label class="label" for="email">
            <span class="label-text">Correo Electrónico</span>
          </label>
          <input type="email" formControlName="email" name="email" class="input input-bordered w-full" required />
          @if(formUtils.isValidField(usuarioForm, 'email')){
          <span class="text-red-500 text-sm mt-0">
            {{formUtils.getFieldError(usuarioForm, 'email')}}
          </span>
          }
        </div>

        <div class="form-control w-full mb-4">
          <label class="label" for="role">
            <span class="label-text">Rol</span>
          </label>
          <select formControlName="role" name="role" class="select select-bordered w-full" required>
            <option disabled selected value="">Selecciona un rol</option>
            <option value="admin">Administrador</option>
            <option value="user">Usuario</option>
          </select>
          @if(formUtils.isValidField(usuarioForm, 'role')){
          <span class="text-red-500 text-sm mt-0">
            {{formUtils.getFieldError(usuarioForm, 'role')}}
          </span>
          }
        </div>

        <div class="form-control w-full mb-4">
          <label class="label" for="password">
            <span class="label-text">Contraseña</span>
          </label>
          <input [type]="showPassword() ? 'text' : 'password'" formControlName="password" name="password"
            class="input input-bordered w-full" required minlength="8" />
          @if(formUtils.isValidField(usuarioForm, 'password')){
          <span class="text-red-500 text-sm mt-0">
            {{formUtils.getFieldError(usuarioForm, 'password')}}
          </span>
          }
        </div>

        <div class="form-control w-full mb-6">
          <label class="label" for="password_confirmation">
            <span class="label-text">Confirmar Contraseña</span>
          </label>
          <input [type]="showPassword() ? 'text' : 'password'" formControlName="password_confirmation"
            name="password_confirmation" class="input input-bordered w-full" required minlength="8" />
          @if(formUtils.isValidField(usuarioForm, 'password_confirmation')){
          <span class="text-red-500 text-sm mt-0">
            {{formUtils.getFieldError(usuarioForm, 'password_confirmation')}}
          </span>
          }
        </div>
        @if(usuarioForm.errors && usuarioForm.touched){
        <span class="form-text text-red-600">
          Las contraseñas deben de ser iguales
        </span>
        }
        <div class="form-control mt-6 flex justify-center">
          <button type="submit" class="btn btn-primary text-base-100" (submit)="registrarUsuario()"
            [disabled]="usuarioForm.invalid">Registrarse</button>
        </div>

      </form>
    </div>
  </div>
</dialog>
